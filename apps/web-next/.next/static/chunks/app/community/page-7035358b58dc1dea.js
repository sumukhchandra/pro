(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{1896:function(e,t,n){Promise.resolve().then(n.bind(n,2907))},2907:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(7437),s=n(2265),c=n(5040);let i=n(357).env.NEXT_PUBLIC_API_BASE||"http://localhost:4000/api";function o(){let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)(null),[l,r]=(0,s.useState)([]),[h,u]=(0,s.useState)(""),[m,d]=(0,s.useState)(null);async function f(){if(!n||!h.trim())return;let e=await fetch("".concat(i,"/community/channels/").concat(n,"/messages"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify({content:h})}),t=await e.json();null==m||m.emit("channelMessage",{channelId:n,message:t}),u("")}return(0,s.useEffect)(()=>{fetch("".concat(i,"/community/channels"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}}).then(e=>e.json()).then(t)},[]),(0,s.useEffect)(()=>{let e=(0,c.io)(i.replace("/api",""));return d(e),()=>{try{e.close()}catch(e){}}},[]),(0,s.useEffect)(()=>{if(m&&n)return m.emit("joinChannel",n),m.on("channelMessage",e=>r(t=>[...t,e])),()=>{m.emit("leaveChannel",n),m.off("channelMessage")}},[m,n]),(0,s.useEffect)(()=>{n&&fetch("".concat(i,"/community/channels/").concat(n,"/messages"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}}).then(e=>e.json()).then(r)},[n]),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"section-title",style:{fontSize:28},children:"Community"}),(0,a.jsxs)("div",{className:"chat",children:[(0,a.jsx)("div",{className:"chat-sidebar",children:e.map(e=>(0,a.jsx)("button",{onClick:()=>o(e._id),className:"btn-outline",style:{display:"block",width:"100%",textAlign:"left",marginBottom:8,borderColor:n===e._id?"var(--gold)":void 0},children:e.name},e._id))}),(0,a.jsxs)("div",{className:"chat-messages",children:[(0,a.jsx)("div",{className:"chat-stream",children:l.map(e=>(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsxs)("span",{className:"gold",children:[new Date(e.timestamp||e.createdAt).toLocaleTimeString(),":"]})," ",e.content]},e._id))}),(0,a.jsxs)("div",{className:"chat-input",children:[(0,a.jsx)("input",{className:"input",value:h,onChange:e=>u(e.target.value),placeholder:"Type your messageâ€¦"}),(0,a.jsx)("button",{className:"btn",onClick:f,children:"Send"})]})]})]})]})}}},function(e){e.O(0,[960,971,23,744],function(){return e(e.s=1896)}),_N_E=e.O()}]);